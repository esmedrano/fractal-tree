<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
    </head>
    <body bgcolor="black">
        <canvas id="fractalTree" width="300" height="300"></canvas>
	<div class="slidecontainer">
 	    <input type="range" min="1" max="100" value="50" class="slider" id="trunk_len">
            <input type="range" min="0" max="1" value=".1" step=".1" class="slider" id="shrink_rate">
            <input type="range" min="0" max="6.2832" value="1.5708" step=".1" class="slider" id="theta">
            <input type="range" min="0" max="6.2832" value=".5236" step=".1" class="slider" id="theta_inc">
            <input type="range" min="0" max="15" value="5" class="slider" id="max_depth">
	</div>
        <script>
            var c=document.getElementById("fractalTree");
            var ctx=c.getContext("2d");
            var PI = 3.1415;
	    var trunk = document.getElementById("trunk_len");
            var shrink = document.getElementById("shrink_rate");
            var theta = document.getElementById("theta");
            var theta_i = document.getElementById("theta_inc");
            var max_depth = document.getElementById("max_depth");
            class FractalTree {
                // constructor(trunk_len, shrink_rate, theta, theta_inc, max_depth) {
                  constructor() {
                    this.self = this;
                    /* this.trunk_len = trunk_len;
                    this.shrink_rate = shrink_rate;
                    this.theta = theta;
                    this.theta_inc = theta_inc;
                    this.max_depth = max_depth; */
                    this.trunk_len = document.getElementById("trunk_len").value;
                    this.shrink_rate = document.getElementById("shrink_rate").value;
                    this.theta = document.getElementById("theta").value;
                    this.theta_inc = document.getElementById("theta_inc").value;
                    this.max_depth = document.getElementById("max_depth").value;
                    this.thetas = [PI / 2];
                    this.points = [];
                    this.start_p = [150, 300];
                    this.end_p1 = 0;
                    this.end_p2 = 0; 
                    this.holder = 0;
                    this.depth = 1; 
                    this.child = 0;
                    this.count = 0;
                    this.pair = 0;
                }
                root() {
                    ctx.beginPath;
                    ctx.moveTo(this.start_p[0], this.start_p[1]);    
                    this.start_p[1] -= this.trunk_len;
                    ctx.lineTo(this.start_p[0], this.start_p[1]);
                    ctx.stroke();
                    this.self.branch(this.start_p[0], this.start_p[1]);
                }
                branch(start_p1, start_p2) {
                    this.trunk_len -= this.trunk_len * this.shrink_rate;
                    for (;this.child < 2 ** this.depth;) {
                        this.holder = this.thetas[this.pair];
                        if (this.child % 2 == 0) {
                            this.thetas[this.pair] -= this.theta_inc;
                            this.thetas.push(this.thetas[this.pair]);
                        }
                        if (this.child % 2 != 0) {
                            this.thetas[this.pair] += this.theta_inc;
                            this.thetas.push(this.thetas[this.pair]);
                        }
                        ctx.beginPath();
                        ctx.moveTo(start_p1, start_p2);
                        this.end_p1 = start_p1 - Math.cos(this.thetas[this.pair]) * this.trunk_len;
                        this.end_p2 = start_p2 - Math.sin(this.thetas[this.pair]) * this.trunk_len;
                        ctx.lineTo(this.end_p1, this.end_p2);
                        ctx.stroke();
                        this.points.push([this.end_p1, this.end_p2]);
                        this.thetas[this.pair] = this.holder;
                        this.child ++;
                        this.count ++;
                        if (this.count % 2 == 0 && this.count != 0) {
                            start_p1 = this.points[this.pair][0];
                            start_p2 = this.points[this.pair][1];
                            this.pair ++;
                        }
                    }
                    this.child = 0;
                    this.depth ++;
                    if (this.depth <= this.max_depth) {
                        this.self.branch(start_p1, start_p2);
                    }
                }
            }
            ctx.fillStyle = "blue";
            ctx.fillRect(0, 0, c.width, c.height);
            fractal = new FractalTree(50, .1, PI / 2, PI / 6, 5);
            fractal.root();
            trunk_len.oninput = function() {
                ctx.clearRect(0, 0, c.width, c.height);
                ctx.fillStyle = "blue";
                ctx.fillRect(0, 0, c.width, c.height);
                // fractal = new FractalTree(this.value, shrink_rate.value, theta.value, theta_inc.value, max_depth.value);
                // fractal = new FractalTree(this.value, .1, PI / 2, PI / 6, 5);
                fractal = new FractalTree();
                fractal.root();
            }
            shrink_rate.oninput = function() {
                ctx.clearRect(0, 0, c.width, c.height);
                ctx.fillStyle = "blue";
                ctx.fillRect(0, 0, c.width, c.height);
                fractal = new FractalTree(trunk_len.value, this.value, theta.value, theta_inc.value, max_depth.value);
                fractal.root();
            }
        </script>
    </body>
</html>
